---
title: pay
slug: /swml/methods/pay
description: Enable secure payment processing during voice calls.
tags: ['swml']
---

import APIField from "@site/src/components/APIField";

[prompt-object]: /swml/methods/pay/prompts
[parameters-object]: /swml/methods/pay/parameters
[supported-languages-voice]: /voice/getting-started/voice-and-languages
[payment_connector_url]: /swml/methods/pay/payment_connector_url
[currency-code]: https://en.wikipedia.org/wiki/ISO_4217

Enable secure payment processing during voice calls. When implemented in your voice application, it manages the entire payment flow, including data collection, validation, and processing, through your configured payment gateway.

<APIField
  name="pay"
  type="object"
  required={true}
>
  An object that accepts the [`pay parameters`](#parameters).
</APIField>



## **Transaction Types**

The `pay` method supports two primary transaction types: `charges` and `tokenization`.

### Charges

When you need to process a payment right away, use a charge transaction. 
This collects the payment details and processes the transaction in real-time.

```yaml andJson
version: 1.0.0
sections:
  main:
    - pay:
        charge_amount: 25.00
        payment_connector_url: "https://example.com/process"
```
Setting any positive value for `charge_amount` initiates a charge transaction.

### Tokenization

Tokenization allows you to securely store payment information for future use. Instead of processing a payment immediately, it generates a secure token that represents the payment method.
To initiate a tokenization transaction, either pass `charge_amount` as `0` or omit the `charge_amount` attribute entirely.

:::note
The token is provided and stored by your payment processor and can be used for future transactions without requiring customers
to re-enter their payment details. Note that this behavior may vary depending on the payment processor you are using.
:::

```yaml andJson
version: 1.0.0
sections:
  main:
    - pay:
        charge_amount: 0
        payment_connector_url: "https://example.com/process"
```



## **Parameters** {#parameters}

<APIField
  name="payment_connector_url"
  type="string"
  required={true}
>
  The URL to make `POST` requests with all the gathered payment details. This URL is used to process the final payment transaction and return the results through the response. Visit the [`payment_connector_url`][payment_connector_url] page for more **important** details.
</APIField>

<APIField
  name="charge_amount"
  type="string"
>
  The amount to charge against payment method passed in the request. `Float` value with no currency prefix passed as string.
</APIField>

<APIField
  name="currency"
  type="string"
  default="usd"
>
  Uses the [ISO 4217 currency code][currency-code] of the charge amount.
</APIField>

<APIField
  name="description"
  type="string"
>
  Custom description of the payment provided in the request.
</APIField>

<APIField
  name="input"
  type="string"
  default="dtmf"
>
  The method of how to collect the payment details. Currently only `dtmf` mode is supported.
</APIField>

<APIField
  name="language"
  type="string"
  default="en-US"
>
  Language to use for prompts being played to the caller by the `pay` method. Supported languages are listed in the [Voice and Languages][supported-languages-voice] page.
</APIField>

<APIField
  name="max_attempts"
  type="integer"
  default="1"
>
  Number of times the `pay` method will retry to collect payment details.
</APIField>

<APIField
  name="min_postal_code_length"
  type="integer"
  default="0"
>
  The minimum length of the postal code the user must enter.
</APIField>

<APIField
  name="parameters"
  type="object[]"
>
  Array of [parameter objects][parameters-object] to pass to your payment processor.
</APIField>

<APIField
  name="payment_method"
  type="string"
>
  Indicates the payment method which is going to be used in this payment request. Currently only `credit-card` is supported.
</APIField>

<APIField
  name="postal_code"
  type="boolean|string"
  default="true"
>
  Takes true, false or real postcode (if it's known beforehand) to let pay method know whether to prompt for postal code.
</APIField>

<APIField
  name="prompts"
  type="object[]"
>
  Array of [prompt objects][prompt-object] for customizing the audio prompts during different stages of the payment process.
</APIField>

<APIField
  name="security_code"
  type="boolean"
  default="true"
>
  Takes true or false to let pay method know whether to prompt for security code.
</APIField>

<APIField
  name="status_url"
  type="string"
>
  The URL to send requests for each status change during the payment process. See the [status_url request body](#status_url_request_body) section for more details.
</APIField>

<APIField
  name="timeout"
  type="integer"
  default="5"
>
  Limit in seconds that pay method waits for the caller to press another digit before moving on to validate the digits captured.
</APIField>

<APIField
  name="token_type"
  type="string"
  default="reusable"
>
  Whether the payment is a one off payment or re-occurring.<br/>**Allowed values:** `one-time`, `reusable`.
</APIField>

<APIField
  name="valid_card_types"
  type="string"
  default="visa mastercard amex"
>
  List of payment cards allowed to use in the requested payment process separated by space.<br/>**Allowed values:** `visa`, `mastercard`, `amex`, `maestro`, `discover`, `jcb`, `diners-club`.
</APIField>

<APIField
  name="voice"
  type="string"
  default="woman"
>
  Text-to-speech voice to use. Supported voices are listed in the [Voice and Languages][supported-languages-voice] page.
</APIField>




### `status_url` request body {#status_url_request_body}

The `status_url` parameter is used to send requests for each status change during the payment process.

<APIField
  name="event_type"
  type="string"
>
  The type of event that is being reported. Will always be `calling.call.pay`.
</APIField>

<APIField
  name="event_channel"
  type="string"
>
  The channel that the event is being reported from.
</APIField>

<APIField
  name="timestamp"
  type="number"
>
  The timestamp of the event in the format of unix timestamp.
</APIField>

<APIField
  name="project_id"
  type="string"
>
  The project ID the event is being reported from.
</APIField>

<APIField
  name="space_id"
  type="string"
>
  The space ID the event is being reported from.
</APIField>

<APIField
  name="params"
  type="object"
>
  An object containing the parameters of the event.
</APIField>

<APIField
  name="params.status_url"
  type="string"
>
  The URL to send requests to for each status change during the payment process.
</APIField>

<APIField
  name="params.status_url_method"
  type="string"
>
  The method to use for the requests to the `status_url`.
</APIField>

<APIField
  name="params.for"
  type="string"
>
  The status of the payment process.
</APIField>

<APIField
  name="params.error_type"
  type="string"
>
  The error type of the payment process.
</APIField>

<APIField
  name="params.payment_method"
  type="string"
>
  The payment method of the payment process.
</APIField>

<APIField
  name="params.payment_card_number"
  type="string"
>
  The payment card number of the payment process.
</APIField>

<APIField
  name="params.payment_card_type"
  type="string"
>
  The payment card type of the payment process.
</APIField>

<APIField
  name="params.security_code"
  type="string"
>
  The security code of the payment process.
</APIField>

<APIField
  name="params.expiration_date"
  type="string"
>
  The expiration date of the payment process.
</APIField>

<APIField
  name="params.payment_card_postal_code"
  type="string"
>
  The payment card postal code of the payment process.
</APIField>

<APIField
  name="params.control_id"
  type="string"
>
  The control ID of the payment process.
</APIField>

<APIField
  name="params.call_id"
  type="string"
>
  The call ID of the payment process.
</APIField>

<APIField
  name="params.node_id"
  type="string"
>
  The node ID of the payment process.
</APIField>

<br></ br>
#### Request format

Below is an example of the request body that will be sent to the `status_url`.


```json
{
  "event_type": "calling.call.pay",
  "event_channel": "swml:XXXX-XXXX-XXXX-XXXX-XXXX",
  "timestamp": 1743707517.12267,
  "project_id": "XXXX-XXXX-XXXX-XXXX-XXXX", 
  "space_id": "XXXX-XXXX-XXXX-XXXX-XXXX",
  "params": {
    "status_url": "https://example.com/status",
    "status_url_method": "POST",
    "for": "payment-completed",
    "error_type": "",
    "payment_method": "credit-card",
    "payment_card_number": "************1234",
    "payment_card_type": "visa",
    "security_code": "***",
    "expiration_date": "1225",
    "payment_card_postal_code": "23112",
    "control_id": "XXXX-XXXX-XXXX-XXXX-XXXX",
    "call_id": "XXXX-XXXX-XXXX-XXXX-XXXX",
    "node_id": "XXXX-XXXX-XXXX-XXXX-XXXX"
  }
}
```



## **Variables**

The following variables are available after the payment process completes:

<APIField
  name="pay_payment_results"
  type="object"
>
  An object containing the payment results of the payment process. Please refer to the [pay_payment_results](#pay_payment_results) section for more details.
</APIField>

<APIField
  name="pay_result"
  type="string"
>
  The result of the payment process. Please refer to the [pay_result](#pay_result) section for possible values.
</APIField>




### pay_payment_results

<APIField
  name="payment_token"
  type="string"
>
  Payment token from processor
</APIField>

<APIField
  name="payment_confirmation_code"
  type="string"
>
  Confirmation code for the transaction
</APIField>

<APIField
  name="payment_card_number"
  type="string"
>
  Redacted card number
</APIField>

<APIField
  name="payment_card_type"
  type="string"
>
  Type of card used
</APIField>

<APIField
  name="payment_card_expiration_date"
  type="string"
>
  Card expiration date
</APIField>

<APIField
  name="payment_card_security_code"
  type="string"
>
  Redacted security code
</APIField>

<APIField
  name="payment_card_postal_code"
  type="string"
>
  Postal code used
</APIField>

<APIField
  name="payment_error"
  type="string"
>
  Error description if payment failed
</APIField>

<APIField
  name="payment_error_code"
  type="string"
>
  Error code if payment failed
</APIField>

<APIField
  name="connector_error"
  type="object"
>
  Connector-specific error object
</APIField>

<APIField
  name="connector_error.code"
  type="string"
>
  Connector-specific error code
</APIField>

<APIField
  name="connector_error.message"
  type="string"
>
  Connector-specific error message
</APIField>

<br></ br>
#### Example

```json
{
  "payment_token": "1234567890",
  "payment_confirmation_code": "1234567890",
  "payment_card_number": "1234567890",
  "payment_card_type": "visa",
  "payment_card_expiration_date": "12/2025",
  "payment_card_security_code": "123",
  "payment_card_postal_code": "12345",
  "payment_error": "Invalid card number",
  "payment_error_code": "invalid-card-number",
  "connector_error": {
    "code": "invalid-card-number",
    "message": "Invalid card number"
  }
}
```


### pay_result

<APIField
  name="success"
  type="string"
>
  The payment was successful.
</APIField>

<APIField
  name="too-many-failed-attempts"
  type="string"
>
  The payment failed because the caller entered too many failed attempts.
</APIField>

<APIField
  name="payment-connector-error"
  type="string"
>
  The payment failed because of an error from the payment connector.
</APIField>

<APIField
  name="caller-interrupted-with-star"
  type="string"
>
  The payment failed because the caller interrupted the payment process with a `*` key.
</APIField>

<APIField
  name="relay-pay-stop"
  type="string"
>
  The payment failed because the caller stopped the payment process with the `STOP` command.
</APIField>

<APIField
  name="caller-hung-up"
  type="string"
>
  The payment failed because the caller hung up.
</APIField>

<APIField
  name="validation-error"
  type="string"
>
  The payment failed because of a validation error.
</APIField>

<APIField
  name="internal-error"
  type="string"
>
  The payment failed because of an internal error.
</APIField>




## **Examples**

### Simple payment collection

```yaml andJson
version: 1.0.0
sections:
  main:
    - pay:
        charge_amount: '20.45'
        payment_connector_url: "https://example.com/process"
        status_url: "https://example.com/status"

```


### Basic tokenization

```yaml andJson
version: 1.0.0
sections:
  main:
    - pay:
        token_type: "reusable"
        charge_amount: '0'
        payment_connector_url: "https://example.com/tokenize"
```

### Retry logic

```yaml andJson
version: 1.0.0
sections:
  main:
    - pay:
        charge_amount: '75.00'
        payment_connector_url: "https://example.com/process"
        max_attempts: 3
        timeout: 10
```

### International payment with custom prompts

```yaml andJson
version: 1.0.0
sections:
  main:
    - pay:
        charge_amount: '100.00'
        payment_connector_url: "https://example.com/process"
        currency: "pln"
        language: "pl-PL"
        description: "Polish zloty transaction"
        prompts:
          - for: "payment-card-number"
            actions:
              - type: "Say"
                phrase: "Witamy w telefonicznym systemie płatności"
              - type: "Say"
                phrase: "Proszę wprowadzić numer karty płatniczej"
          - for: "payment-card-number"
            error_type: "invalid-card-number timeout invalid-card-type"
            actions:
              - type: "Say"
                phrase: "Wprowadziłeś błędny numer karty płatniczej. Proszę spróbować ponownie"
          - for: "payment-completed"
            actions:
              - type: "Say"
                phrase: "Płatność zakończona powodzeniem"
```