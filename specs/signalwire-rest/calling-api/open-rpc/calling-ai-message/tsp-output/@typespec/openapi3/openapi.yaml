openapi: 3.0.0
info:
  title: Calling API - Inject AI Message
  version: 1.0.0
  contact:
    name: SignalWire
    url: https://support.signalwire.com/portal/en/newticket?departmentId=1029313000000006907&layoutId=1029313000000074011
    email: support@signalwire.com
  license:
    name: MIT
    url: https://github.com/signalwire/docs/blob/main/LICENSE
  termsOfService: https://signalwire.com/legal/signalwire-cloud-agreement
  description: API to inject messages into AI SignalWire call conversations using the calling.ai_message command.
externalDocs:
  url: https://developer.signalwire.com/rest/signalwire-rest/endpoints/calling/calls/calling-ai-message
  description: Documentation for the calling.ai_message command to inject messages into AI conversations.
tags:
  - name: Calls
    description: Endpoints related to creating and managing calls
    externalDocs:
      url: https://developer.signalwire.com/rest/signalwire-rest/endpoints/calling/calls
      description: Developer documentation on Calling API Call endpoints
paths:
  /calls:
    post:
      operationId: inject-ai-message
      summary: Inject AI Message
      description: To inject a message into an existing AI call conversation, you send a `POST` request to the Call resource with a payload including a `calling.ai_message` command, the call ID, and message details. Messages can be injected as system instructions, user messages, or assistant responses.
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CallResponse'
        '401':
          description: Access is unauthorized.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Types.StatusCodes.StatusCode401'
        '404':
          description: The server cannot find the requested resource.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Types.StatusCodes.StatusCode404'
        '422':
          description: Client error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CallUpdate422Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Types.StatusCodes.StatusCode500'
      tags:
        - Calls
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CallAIMessageRequest'
security:
  - BasicAuth: []
components:
  schemas:
    CallAIMessageRequest:
      type: object
      required:
        - id
        - command
        - params
      properties:
        id:
          allOf:
            - $ref: '#/components/schemas/uuid'
          description: The unique identifying ID of a existing call.
          example: 3fa85f64-5717-4562-b3fc-2c963f66afa6
        command:
          type: string
          enum:
            - calling.ai_message
          description: The `calling.ai_message` command is used to inject a message into the AI conversation.
          example: calling.ai_message
        params:
          type: object
          properties:
            role:
              type: string
              enum:
                - system
                - user
                - assistant
              description: |-
                The role that the message is from. Each role type has a different purpose and will influence how the AI will interpret the message.
                - `system`: Inject instructions or context that modify the AI's behavior mid-conversation without the caller hearing it. This could change the AI's personality, add new constraints, provide context about the conversation, or give the AI information it should know going forward.
                - `user`: Inject a message as if the caller said it. This would appear in the conversation history as coming from the caller, and the AI would respond to it as if the caller just spoke it.
                - `assistant`: Inject a message as if the AI said it. This would appear as an AI response in the conversation history. The AI would treat this as its own previous response when generating future replies.
              example: system
            message_text:
              type: string
              description: The text content that will be sent to the AI.
              example: You are now in expert mode. Provide detailed technical responses.
          required:
            - role
            - message_text
          description: An object of parameters that will be utilized by the active command.
      title: Inject AI message
    CallResponse:
      type: object
      required:
        - id
        - from
        - to
        - direction
        - status
        - duration
        - duration_ms
        - billing_ms
        - source
        - type
        - url
        - charge
        - created_at
        - parent_id
        - charge_details
      properties:
        id:
          type: string
          description: The unique identifier of the call on SignalWire. This can be used to update the call programmatically.
          example: 0e9c80d7-a149-4917-892d-420043709f45
        from:
          type: string
          description: The origin number or address.
          example: '+12069708643'
        to:
          type: string
          description: The destination number or address.
          example: '+18048390497'
        direction:
          type: string
          enum:
            - outbound-api
          description: The direction of the call.
          example: outbound-api
        status:
          type: string
          enum:
            - answered
            - queued
            - initiated
            - ringing
            - ending
            - ended
          description: The status of the call.
          example: queued
        duration:
          type: integer
          nullable: true
          description: The duration of the call in seconds.
          example: null
        duration_ms:
          type: integer
          nullable: true
          description: The duration of the call in milliseconds.
          example: null
        billing_ms:
          type: integer
          nullable: true
          description: The billable duration of the call in milliseconds.
          example: null
        source:
          type: string
          enum:
            - realtime_api
          description: Source of this call.
          example: realtime_api
        type:
          type: string
          enum:
            - relay_pstn_call
            - relay_sip_call
            - relay_webrtc_call
          description: Type of this call.
          example: relay_pstn_call
        url:
          type: string
          nullable: true
          description: The URL associated with this call.
          example: null
        charge:
          type: number
          format: double
          description: Total charge for this call.
          example: 0
        created_at:
          type: string
          format: date-time
          description: The date and time when the call was created.
          example: '2024-05-06T12:20:00Z'
        parent_id:
          type: string
          nullable: true
          description: The parent call ID if this is a child call.
          example: null
        charge_details:
          type: array
          items:
            $ref: '#/components/schemas/ChargeDetails'
          description: Details on charges associated with this call.
    CallUpdate422Error:
      type: object
      required:
        - errors
      properties:
        errors:
          type: array
          items:
            $ref: '#/components/schemas/Types.StatusCodes.StatusCode422Error'
      example:
        errors:
          - type: validation_error
            code: missing_required_parameter
            message: url must be a valid http or https url
            attribute: url
            url: https://developer.signalwire.com/rest/signalwire-rest/overview/error-codes#http_url_required
    ChargeDetails:
      type: object
      required:
        - description
        - amount
      properties:
        description:
          type: string
          description: Description for this charge.
          example: Text to Speech
        amount:
          type: number
          description: Charged amount.
          example: 0.121176
    Types.StatusCodes.StatusCode401:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          enum:
            - Unauthorized
    Types.StatusCodes.StatusCode404:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          enum:
            - Not Found
    Types.StatusCodes.StatusCode422Error:
      type: object
      required:
        - type
        - code
        - message
        - attribute
        - url
      properties:
        type:
          type: string
          description: Error type.
        code:
          type: string
          description: Error code.
        message:
          type: string
          description: Error details.
        attribute:
          type: string
          description: Request parameter associated with this error.
        url:
          type: string
          description: Link to developer resource for this error.
    Types.StatusCodes.StatusCode500:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          enum:
            - Internal Server Error
    uuid:
      type: string
      format: uuid
      description: Universal Unique Identifier.
  securitySchemes:
    BasicAuth:
      type: http
      scheme: Basic
servers:
  - url: https://{space_name}.signalwire.com/api/calling
    description: Endpoint
    variables:
      space_name:
        default: '{Your_Space_Name}'
        description: The domain of the users SignalWire space.
